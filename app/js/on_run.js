function OnRun($rootScope, $stateParams, AppSettings, $uibModal, $log, $q, $cookies, $http, $state, $location) {
  'ngInject';  $rootScope.$state = $state;  $rootScope.$stateParams = $stateParams;  // Set page rendered to false  $rootScope.pageRendered = true;  // Set user logged in to false  $rootScope.userLoggedIn = false;  $rootScope.$loggedInUser = "not-logged-in";  // Get API URL  $rootScope.apiUrl = AppSettings.apiUrl;  // Get Image URL  $rootScope.imageUrl = AppSettings.imageUrl;

  // Sets defer for user data to load
  $rootScope.waitForData = $q.defer();  // If cookie has auth_key  if ($cookies.get('auth_key')) {    $rootScope.authToken = $cookies.get('auth_key');    // Now get user data    $http.get($rootScope.apiUrl + 'users/one?_auth_key=' + $cookies.get('auth_key'))      .then(function successCallback(response) {        // Assign all user data to rootScope - This to be used across all controllers        $rootScope.userData = response.data.data;        // Set logged in to true        $rootScope.userLoggedIn = true;        $rootScope.$loggedInUser = "logged-in";        // User data has now been loaded        $rootScope.waitForData.resolve();      });  }  $rootScope.SignUpModal = function(size) {    var modalInstance = $uibModal.open({      templateUrl: 'modals/signup.html',      controller: ['$scope', '$uibModalInstance', '$http', '$rootScope', SignUpCtrl],      size: size    });  };  $rootScope.LogInModal = function(size) {    var modalInstance = $uibModal.open({      templateUrl: 'modals/login.html',      controller: ['$scope', '$uibModalInstance', '$http', '$rootScope', '$cookies', '$log', '$state', LogInCtrl],      size: size    });  };  function SignUpCtrl($scope, $uibModalInstance, $http, $rootScope) {    // Sign up user    $scope.SignUpForm = function() {      $scope.isSubmitting = true;      $scope.formError = false;      $scope.formErrorData = [""];      var signUpData = {        'firstName': $scope.firstname,        'lastName': $scope.lastname,        'email': $scope.email,        'password': $scope.password      };      $http.post($rootScope.apiUrl + 'users/create', signUpData)        .then(function successCallback(response) {          if (response.data.errors[0]) {            // Log the response            $log.error('errors', response);            $scope.isSubmitting = false;            $scope.formError = true;            $scope.formErrorData = response.data.errors;          }          if (response.data.result == 1) {            $uibModalInstance.close();            $scope.isSubmitting = false;            $rootScope.alert = true;            $rootScope.alertMessage = 'Thank you for signing up, please verify your email address';            $rootScope.alertResponse = 'alert-success';          }        }, function errorCallback(response) {          // Log the response          $log.error('error', response);          $scope.isSubmitting = false;          $scope.formError = true;          $scope.formErrorData = ['Sorry there seems to be something wrong on our end, please try again...'];        });    };    $scope.LoginSwitch = function() {      $uibModalInstance.close();      setTimeout(function() {        $rootScope.LogInModal('sm');      }, 200);    };  }  function LogInCtrl($scope, $uibModalInstance, $http, $rootScope, $cookies, $log, $state) {    // Log in user    $scope.LogInForm = function() {      $scope.isSubmitting = true;      $scope.formError = false;      $scope.formErrorData = [""];      var LogInData = {        'email': $scope.email,        'password': $scope.password      };      var config = {          headers : {              'Content-Type': 'application/json;'          }      };      $http.post($rootScope.apiUrl + 'users/login', LogInData)        .then(function successCallback(response) {          if (response.data.errors[0]) {            // Log the response            $log.error('errors', response);            $scope.isSubmitting = false;            $scope.formError = true;            $scope.formErrorData = response.data.errors;          }          if (response.data.result == 1) {            var authKey = response.data.data.auth_key;            $log.info(authKey);            $rootScope.userLoggedIn = true;            $cookies.put('auth_key', authKey);            $rootScope.authToken = $cookies.get('auth_key');            // Get logged in user name            $http.get($rootScope.apiUrl + 'users/one?_auth_key=' + $rootScope.authToken)              .then(function successCallback(response) {                // Assign all user data to rootScope - This to be used across all controllers                $rootScope.userData = response.data.data;                // Set logged in to true                $rootScope.userLoggedIn = true;                $rootScope.$loggedInUser = "logged-in";                // User data has now been loaded                $rootScope.waitForData.resolve();                // Close the modal                $uibModalInstance.close();                $scope.isSubmitting = false;                $state.go('User-Dashboard');                //TODO: if User-Dashboard reload              }, function errorCallback(response, status, headers, config) {                $log.error("Response: ", response);                $log.error("Status: ", status);                $log.error("Headers: ", headers);                $log.error("Config: ", config);                $rootScope.alert = true;                $rootScope.alertMessage = 'Sorry there seems to be something wrong with getting your user details';                $rootScope.alertResponse = 'alert-danger';                $uibModalInstance.close();                $scope.isSubmitting = false;                $state.go('Home');                //TODO: if Home reload              });          }        }, function errorCallback(response) {          // Log the response          $log.error('error', response);          $scope.isSubmitting = false;          $scope.formError = true;          $scope.formErrorData = ['Sorry there seems to be something wrong on our end, please try again...'];        });    };    $scope.SignUpSwitch = function() {      $uibModalInstance.close();      setTimeout(function() {        $rootScope.SignUpModal('sm');      }, 200);    };  }  // Log out  $rootScope.logOut = function() {    $cookies.remove('auth_key');    $rootScope.authToken = "";    $rootScope.userLoggedIn = false;    $rootScope.userProfile = "";    $rootScope.userImage = "";    $rootScope.userId = "";    $rootScope.$loggedInUser = "not-logged-in";    $state.reload();  }  // Event listeners  // On location change  $rootScope.$on('$locationChangeSuccess', function(event, toState, toParams, fromState, fromParams){    $rootScope.isIndex = $location.path() == '/';  });}export default OnRun;
